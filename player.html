<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>مشغل المحاضرات</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="player-card">

  <!-- رقم المحاضرة -->
  <h2 id="title">تحميل المحاضرة...</h2>

  <!-- مشغل بصري -->
  <div class="audio-player">
    <!-- زر دائري للتشغيل -->
    <div class="play-circle" id="playBtn">
      ▶
      <svg class="progress-ring" width="120" height="120">
        <circle class="progress-ring__circle" stroke="#ffd166" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/>
      </svg>
    </div>

    <!-- أزرار التحكم بالوقت -->
    <div class="time-controls">
      <button onclick="decreaseTime()">➖</button>
      <span id="timeValue">0</span>
      <button onclick="increaseTime()">➕</button>
    </div>
  </div>

  <audio id="audio" src="" preload="metadata"></audio>

  <div class="footer">مكتبة الكتب الصوتية</div>
  <div class="footer">إعداد : م / وسام صلاح جودة</div>

</div>

<script>
  const params = new URLSearchParams(window.location.search);
  const title = params.get('title') || '';
  const src = params.get('src') || '';

  document.getElementById('title').textContent = `المحاضرة رقم ${title}`;
  const audio = document.getElementById('audio');
  audio.src = src;

  // العداد بالدقائق
  const timeValueEl = document.getElementById('timeValue');
  let currentMinutes = 0;
  let maxMinutes = 0;

  audio.addEventListener('loadedmetadata', () => {
    maxMinutes = Math.floor(audio.duration / 60);
    if(maxMinutes < 1) maxMinutes = 1;
  });

  function increaseTime(){
    if(currentMinutes < maxMinutes){
      currentMinutes++;
      updateTime();
    }
  }
  function decreaseTime(){
    if(currentMinutes > 0){
      currentMinutes--;
      updateTime();
    }
  }
  function updateTime(){
    timeValueEl.textContent = currentMinutes;
  }

  // زر التشغيل مع حلقة التقدم
  const playBtn = document.getElementById('playBtn');
  const progressCircle = document.querySelector('.progress-ring__circle');
  const radius = progressCircle.r.baseVal.value;
  const circumference = 2 * Math.PI * radius;
  progressCircle.style.strokeDasharray = `${circumference} ${circumference}`;
  progressCircle.style.strokeDashoffset = circumference;

  function setProgress(percent){
    const offset = circumference - percent / 100 * circumference;
    progressCircle.style.strokeDashoffset = offset;
  }

  playBtn.addEventListener('click', () => {
    if(audio.paused){
      audio.play();
      playBtn.textContent = '⏸';
    } else {
      audio.pause();
      playBtn.textContent = '▶';
    }
  });

  // تحديث الحلقة أثناء التشغيل
  audio.addEventListener('timeupdate', () => {
    const percent = (audio.currentTime / audio.duration) * 100;
    setProgress(percent);
  });

  // تقديم / تأخير بالدقائق
  function goToTime(minutes){
    audio.currentTime = minutes * 60;
  }
</script>

</body>
</html>
