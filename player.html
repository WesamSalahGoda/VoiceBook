<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…Ø´ØºÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="player-card">

  <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© -->
  <h2 id="title">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©...</h2>

  <!-- Ø§Ù„Ù…Ø´ØºÙ„ Ø§Ù„Ø¨ØµØ±ÙŠ -->
  <div class="audio-player">

    <!-- ØµÙ Ø§Ù„ÙˆÙ‚Øª + Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ -->
    <div class="player-time-row">

      <!-- Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ -->
      <span id="currentTimeLabel">00:00:00</span>

      <!-- Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ -->
      <div class="play-circle" id="playBtn">
        â–¶
        <svg class="progress-ring" width="120" height="120">
          <circle class="progress-ring__circle"
                  stroke="#ffd166"
                  stroke-width="6"
                  fill="transparent"
                  r="54" cx="60" cy="60"/>
        </svg>
      </div>

      <!-- Ø§Ù„Ù…Ø¯Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© -->
      <span id="durationLabel">00:00:00</span>

    </div>

    <!-- Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ -->
    <div class="time-controls">
      <button id="minusBtn" onclick="decreaseTime()">âž–</button>
      <span id="timeValue">0</span>
      <button id="plusBtn" onclick="increaseTime()">âž•</button>
    </div>

  </div>

  <!-- Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ -->
  <audio id="audio" preload="metadata"></audio>

  <div class="footer">Ù…ÙƒØªØ¨Ø© Ø§Ù„ÙƒØªØ¨ Ø§Ù„ØµÙˆØªÙŠØ©</div>
  <div class="footer">Ø¥Ø¹Ø¯Ø§Ø¯ : Ù… / ÙˆØ³Ø§Ù… ØµÙ„Ø§Ø­ Ø¬ÙˆØ¯Ø©</div>

</div>

<script>
  /* ===============================
     Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©
  =============================== */
  const params = new URLSearchParams(window.location.search);
  const title = params.get('title') || '';
  const src = params.get('src') || '';

  document.getElementById('title').textContent = `Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø±Ù‚Ù… ${title}`;

  const audio = document.getElementById('audio');
  audio.src = src;

  /* ===============================
     ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª HH:MM:SS
  =============================== */
  function formatTime(totalSeconds) {
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = Math.floor(totalSeconds % 60);

    return (
      String(hours).padStart(2, '0') + ':' +
      String(minutes).padStart(2, '0') + ':' +
      String(seconds).padStart(2, '0')
    );
  }

  const currentTimeLabel = document.getElementById('currentTimeLabel');
  const durationLabel = document.getElementById('durationLabel');

  audio.addEventListener('loadedmetadata', () => {
    durationLabel.textContent = formatTime(audio.duration);
  });

  audio.addEventListener('timeupdate', () => {
    currentTimeLabel.textContent = formatTime(audio.currentTime);
  });

  /* ===============================
     Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚
  =============================== */
  const timeValueEl = document.getElementById('timeValue');
  const plusBtn = document.getElementById('plusBtn');
  const minusBtn = document.getElementById('minusBtn');

  let currentMinutes = 0;
  let maxMinutes = 0;

  audio.addEventListener('loadedmetadata', () => {
    maxMinutes = Math.floor(audio.duration / 60);
    if (maxMinutes < 1) maxMinutes = 1;
  });

  function increaseTime() {
    if (!audio.paused) return; // âŒ Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„

    if (currentMinutes < maxMinutes) {
      currentMinutes++;
      updateMinuteLabel();
    }
  }

  function decreaseTime() {
    if (!audio.paused) return; // âŒ Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„

    if (currentMinutes > 0) {
      currentMinutes--;
      updateMinuteLabel();
    }
  }

  function updateMinuteLabel() {
    timeValueEl.textContent = currentMinutes;
    audio.currentTime = currentMinutes * 60;
  }

  /* ===============================
     ØªØ¹Ø·ÙŠÙ„ / ØªÙØ¹ÙŠÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚
  =============================== */
  function setMinuteButtonsState(disabled) {
    plusBtn.disabled = disabled;
    minusBtn.disabled = disabled;

    plusBtn.style.opacity = disabled ? '0.5' : '1';
    minusBtn.style.opacity = disabled ? '0.5' : '1';
    plusBtn.style.cursor = disabled ? 'not-allowed' : 'pointer';
    minusBtn.style.cursor = disabled ? 'not-allowed' : 'pointer';
  }

  /* ===============================
     Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ + Ø§Ù„Ø­Ù„Ù‚Ø©
  =============================== */
  const playBtn = document.getElementById('playBtn');
  const progressCircle = document.querySelector('.progress-ring__circle');
  const radius = progressCircle.r.baseVal.value;
  const circumference = 2 * Math.PI * radius;

  progressCircle.style.strokeDasharray = `${circumference} ${circumference}`;
  progressCircle.style.strokeDashoffset = circumference;

  function setProgress(percent) {
    const offset = circumference - (percent / 100) * circumference;
    progressCircle.style.strokeDashoffset = offset;
  }

  playBtn.addEventListener('click', () => {
    if (audio.paused) {
      audio.play();
      playBtn.textContent = 'â¸';
      setMinuteButtonsState(true);   // ðŸ”’ Ù‚ÙÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    } else {
      audio.pause();
      playBtn.textContent = 'â–¶';
      setMinuteButtonsState(false);  // ðŸ”“ ÙØªØ­ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    }
  });

  audio.addEventListener('timeupdate', () => {
    const percent = (audio.currentTime / audio.duration) * 100;
    setProgress(percent);
  });
</script>

</body>
</html>
