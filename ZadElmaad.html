<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>سلسلة المحاضرات الصوتية</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">

</head>
<body>

  <div class="container">
    <h1>سلسلة المحاضرات الصوتية</h1>
    <h2>شرح كتاب زاد المعاد</h2>
    <h3>للشيخ عادل السيد</h3>
    <p>اختر رقم المحاضرة للاستماع</p>

    <div class="grid" id="lecturesGrid"></div>
  </div>

  <!-- كارت المشغل واحد فقط -->
  <div class="player-card" id="playerCard" style="display:none;">
    <button class="close-btn" onclick="closePlayer()">×</button>
    <div class="player-time-row">
      <span id="currentTimeLabel">00:00:00</span>
      <div class="play-circle" id="playBtn">▶
        <svg class="progress-ring" width="120" height="120">
          <circle class="progress-ring__circle" stroke="#ffd166" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/>
        </svg>
      </div>
      <span id="durationLabel">00:00:00</span>
    </div>
    <div class="time-controls">
      <button onclick="decreaseTime()">➖</button>
      <span id="timeValue">0</span>
      <button onclick="increaseTime()">➕</button>
    </div>
    <audio id="audio" preload="metadata"></audio>
  </div>

  <script>
    const baseUrl = 'https://archive.org/download/Adelelsayd-zad-el-maad/';
    const lecturesGrid = document.getElementById('lecturesGrid');
    const playerCard = document.getElementById('playerCard');
    const audio = document.getElementById('audio');
    const playBtn = document.getElementById('playBtn');
    const currentTimeLabel = document.getElementById('currentTimeLabel');
    const durationLabel = document.getElementById('durationLabel');
    const timeValueEl = document.getElementById('timeValue');

    let currentMinutes = 0;
    let maxMinutes = 0;

    // توليد أزرار المحاضرات
    for (let i = 1; i <= 98; i++) {
      const number = String(i).padStart(2, '0');
      const audioSrc = `${baseUrl}${number}.mp3`;
      const btn = document.createElement('div');
      btn.className = 'btn';
      btn.textContent = `المحاضرة ${i}`;
      btn.onclick = () => openPlayer(i, audioSrc, btn);
      lecturesGrid.appendChild(btn);
    }

    function openPlayer(title, src, btn) {
      stopAudio();
      audio.src = src;
      playerCard.style.display = 'block';
      btn.after(playerCard);
      document.getElementById('title').textContent = `المحاضرة رقم ${title}`;
      audio.load();
      audio.pause();
      playBtn.textContent = '▶';
      currentMinutes = 0;
      timeValueEl.textContent = currentMinutes;
    }

    function closePlayer() {
      audio.pause();
      playerCard.style.display = 'none';
    }

    // زر التشغيل وحلقة التقدم
    const progressCircle = document.querySelector('.progress-ring__circle');
    const radius = progressCircle.r.baseVal.value;
    const circumference = 2 * Math.PI * radius;
    progressCircle.style.strokeDasharray = `${circumference} ${circumference}`;
    progressCircle.style.strokeDashoffset = circumference;

    function setProgress(percent) {
      const offset = circumference - (percent / 100) * circumference;
      progressCircle.style.strokeDashoffset = offset;
    }

    playBtn.addEventListener('click', () => {
      if(audio.paused){
        audio.play();
        playBtn.textContent = '⏸';
      } else {
        audio.pause();
        playBtn.textContent = '▶';
      }
    });

    audio.addEventListener('timeupdate', () => {
      const percent = (audio.currentTime / audio.duration) * 100;
      setProgress(percent);
      currentTimeLabel.textContent = formatTime(audio.currentTime);
    });

    audio.addEventListener('loadedmetadata', () => {
      maxMinutes = Math.floor(audio.duration / 60);
      if(maxMinutes < 1) maxMinutes = 1;
      durationLabel.textContent = formatTime(audio.duration);
    });

    // العداد بالدقائق (يعمل فقط عند الإيقاف)
    function increaseTime() {
      if(audio.paused && currentMinutes < maxMinutes){
        currentMinutes++;
        updateMinuteLabel();
      }
    }
    function decreaseTime() {
      if(audio.paused && currentMinutes > 0){
        currentMinutes--;
        updateMinuteLabel();
      }
    }
    function updateMinuteLabel(){
      timeValueEl.textContent = currentMinutes;
      audio.currentTime = currentMinutes * 60;
    }

    function formatTime(totalSeconds){
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = Math.floor(totalSeconds % 60);
      return `${String(hours).padStart(2,'0')}:${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`;
    }

    function stopAudio(){
      audio.pause();
      playBtn.textContent = '▶';
    }
  </script>

</body>
</html>
